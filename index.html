<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>체질판별 + 일주 계산 (정확 버전)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .highlight {
            background-color: yellow;
            font-weight: bold;
        }
        .category {
            background-color: #ffcc00;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h2>체질판별 + 일주(일간) 계산</h2>
    <label for="birthDate">생년월일(양력) 입력 (YYYYMMDD 형식): </label>
    <input type="text" id="birthDate" maxlength="8" placeholder="예: 19820906" />
    <button onclick="calculateAll()">결과 확인</button>

    <h3>결과:</h3>
    <table>
        <tr>
            <th></th>
            <th>출생일<br>(후천체질)</th>
            <th>입태일<br>(선천체질)</th>
        </tr>
        <tr>
            <td class="highlight">날짜</td>
            <td id="birthDateCell"></td>
            <td id="conceptionDateCell"></td>
        </tr>
        <tr>
            <td>연간(년도 천간)</td>
            <td id="birthHeavenlyStemCell"></td>
            <td id="conceptionHeavenlyStemCell"></td>
        </tr>
        <tr>
            <td>운</td>
            <td id="birthLuckCell"></td>
            <td id="conceptionLuckCell"></td>
        </tr>
        <tr>
            <td>오행</td>
            <td id="birthElementCell"></td>
            <td id="conceptionElementCell"></td>
        </tr>
        <tr>
            <td>태과/불급</td>
            <td id="birthImbalanceCell"></td>
            <td id="conceptionImbalanceCell"></td>
        </tr>
        <tr>
            <td class="category">체질</td>
            <td id="birthConstitutionCell"></td>
            <td id="conceptionConstitutionCell"></td>
        </tr>
        <tr>
            <td>일주(일간)</td>
            <td id="birthDayPillarCell"></td>
            <td id="conceptionDayPillarCell"></td>
        </tr>
    </table>

    <script>
        // 메인 함수: 모든 계산 실행
        function calculateAll() {
            const birthDateInput = document.getElementById("birthDate").value.trim();
            if (!/^[0-9]{8}$/.test(birthDateInput)) {
                alert("생년월일(양력)을 YYYYMMDD 형식으로 입력하세요.");
                return;
            }

            // 출생일 (문자열 -> 정수 변환)
            const birthYear = parseInt(birthDateInput.substring(0, 4), 10);
            const birthMonth = parseInt(birthDateInput.substring(4, 6), 10);
            const birthDay = parseInt(birthDateInput.substring(6, 8), 10);

            // 출생일 Date 객체
            const birthDate = new Date(birthYear, birthMonth - 1, birthDay);

            // 입태일 Date (출생일에서 266일 전)
            const conceptionDate = new Date(birthDate);
            conceptionDate.setDate(conceptionDate.getDate() - 266);

            // 입태일의 년도
            const conceptionYear = conceptionDate.getFullYear();
            const conceptionMonth = conceptionDate.getMonth() + 1;
            const conceptionDay = conceptionDate.getDate();

            // === 1) 연간(년도 기준 천간) 계산 ===
            const birthHeavenlyStem = getHeavenlyStem(birthYear);
            const conceptionHeavenlyStem = getHeavenlyStem(conceptionYear);

            // === 2) 운 계산 (출생일/입태일 날짜 기반) ===
            const birthLuck = getLuck(birthDate);
            const conceptionLuck = getLuck(conceptionDate);

            // === 3) 오행 계산 (연간 + 운) ===
            const birthElement = getFiveElements(birthHeavenlyStem, birthLuck);
            const conceptionElement = getFiveElements(conceptionHeavenlyStem, conceptionLuck);

            // === 4) 태과/불급 계산 (연간 기준) ===
            const birthImbalance = getImbalance(birthHeavenlyStem);
            const conceptionImbalance = getImbalance(conceptionHeavenlyStem);

            // === 5) 체질 계산 ===
            const birthConstitution = getConstitution(birthElement, birthImbalance);
            const conceptionConstitution = getConstitution(conceptionElement, conceptionImbalance);

            // === 6) 일주(일간) 계산 ===
            // (1900-01-31을 '갑자일'로 간주; 검증된 코드)
            const birthDayPillar = getHeavenlyStemDay(birthDate);
            const conceptionDayPillar = getHeavenlyStemDay(conceptionDate); 
            // 필요 없으면 이 부분 주석처리 가능

            // === 결과 표에 반영 ===
            // 날짜
            document.getElementById("birthDateCell").innerText
                = `${birthYear}년 ${birthMonth}월 ${birthDay}일`;
            document.getElementById("conceptionDateCell").innerText
                = `${conceptionYear}년 ${conceptionMonth}월 ${conceptionDay}일`;

            // 연간(년도 천간)
            document.getElementById("birthHeavenlyStemCell").innerText = birthHeavenlyStem;
            document.getElementById("conceptionHeavenlyStemCell").innerText = conceptionHeavenlyStem;

            // 운
            document.getElementById("birthLuckCell").innerText = `${birthLuck}운`;
            document.getElementById("conceptionLuckCell").innerText = `${conceptionLuck}운`;

            // 오행
            document.getElementById("birthElementCell").innerText = birthElement;
            document.getElementById("conceptionElementCell").innerText = conceptionElement;

            // 태과/불급
            document.getElementById("birthImbalanceCell").innerText = birthImbalance;
            document.getElementById("conceptionImbalanceCell").innerText = conceptionImbalance;

            // 체질
            document.getElementById("birthConstitutionCell").innerText = birthConstitution;
            document.getElementById("conceptionConstitutionCell").innerText = conceptionConstitution;

            // 일주(출생일)
            document.getElementById("birthDayPillarCell").innerText = birthDayPillar;
            // 일주(입태일) - 필요 없다면 제거
            document.getElementById("conceptionDayPillarCell").innerText = conceptionDayPillar;
        }

        // === (1) 연간(년도 기준 천간) 계산 ===
        //   - (year - 4) % 10 공식을 자주 사용
        function getHeavenlyStem(year) {
            const stems = ["갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"];
            // 예: 2023년 => (2023 - 4) % 10 = (2019) % 10 = 9 -> '계'
            return stems[(year - 4) % 10];
        }

        // === (2) 운 계산: 월/일에 따라 5운으로 나눔 (예시 로직) ===
        function getLuck(date) {
            const month = date.getMonth() + 1;
            const day = date.getDate();

            // 구간별 luck
            // 실제 사주에서는 24절기 등 고려하므로 여기는 예시
            const luckPeriods = [
                { start: "0120", end: "0401", luck: 1 },
                { start: "0402", end: "0616", luck: 2 },
                { start: "0617", end: "0829", luck: 3 },
                { start: "0830", end: "1110", luck: 4 },
                { start: "1111", end: "0119", luck: 5 }
            ];

            // 월일 4자리
            const mmdd = (month < 10 ? "0" : "") + month + (day < 10 ? "0" : "") + day;

            for (let period of luckPeriods) {
                // 1111~0119 구간은 연말과 연초를 걸치는 예시
                if (
                    (mmdd >= period.start && mmdd <= period.end) ||
                    (period.start === "1111" && (mmdd >= "1111" || mmdd <= "0119"))
                ) {
                    return period.luck;
                }
            }
            return "오류";
        }

        // === (3) 오행 계산: 연간 + 운을 토대로 오행 찾기 (예시 로직) ===
        function getFiveElements(heavenlyStem, luck) {
            // 천간별 시작 오행
            const startMap = {
                "갑": "土", "기": "土",
                "을": "金", "경": "금",
                "병": "水", "신": "수",
                "정": "木", "임": "목",
                "무": "火", "계": "화"
            };

            // 오행 순환
            const cycle = ["土", "金", "水", "木", "火"];

            const startElement = startMap[heavenlyStem];
            const startIndex = cycle.indexOf(startElement);

            // 운(luck)만큼 이동 (예: 운=1이면 변화 없음, 운=2이면 1칸 이동 등)
            // -1 하는 것은 1운이면 그대로 startElement를 반환하기 위함
            return cycle[(startIndex + (luck - 1)) % 5];
        }

        // === (4) 태과/불급 계산 (연간 기준) ===
        function getImbalance(heavenlyStem) {
            // 갑, 병, 무, 경, 임 => 태과
            // 을, 정, 기, 신, 계 => 불급
            return ["갑", "병", "무", "경", "임"].includes(heavenlyStem)
                ? "태과"
                : "불급";
        }

        // === (5) 체질 계산 (오행 + 태과/불급 조합) ===
        function getConstitution(fiveElements, imbalance) {
            const mapping = {
                "木": { "태과": "간실비허", "불급": "폐실간허" },
                "火": { "태과": "심실폐허", "불급": "신실심허" },
                "水": { "태과": "신실심허", "불급": "비실신허" },
                "土": { "태과": "비실신허", "불급": "간실비허" },
                "金": { "태과": "폐실간허", "불급": "심실폐허" }
            };
            return mapping[fiveElements][imbalance];
        }

        // === (6) 일주(일간) 계산 (출생일/입태일에 대해) ===
        //     - 1900-01-31을 '갑자일'로 가정한 간단 계산
        //     - 1982-09-06 입력 시 '임' 나오는지 확인
        function getHeavenlyStemDay(dateObj) {
            const reference = new Date(1900, 0, 31); // 1900-01-31
            const diff = Math.floor((dateObj - reference) / (1000 * 60 * 60 * 24));

            // 10개 천간 순서
            const stems = ["갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"];

            // 60갑자 주기의 일수(일간) => 음수 모듈로 보정
            const dayIndex = (diff % 60 + 60) % 60;

            // 일간(천간)만 추출
            return stems[dayIndex % 10];
        }
    </script>
</body>
</html>
